#
# IMPORTANT NOTE
#
# This chart inherits from k8s common library chart. You can check the default values/options here:
# https://github.com/zekker6/helm-charts/blob/main/charts/library/common/values.yaml
#

# -- See the following files for additional environment variables:
# https://github.com/nocodb/nocodb#docker
# @default -- See below

image:
  # -- image repository
  repository: docker.io/nocodb/nocodb
  # -- image pull policy
  pullPolicy: IfNotPresent
  # -- image tag
  # @default -- chart.appVersion
  tag: 0.264.9

env:
  # NocoDB Database Connection - CloudNativePG Secret 참조
  NC_DB:
    valueFrom:
      secretKeyRef:
        name: nocodb-env-secrets
        key: NC_DB
  # NC_REDIS_URL: 'redis://nocodb-redis-master.redis.svc.cluster.local:6379/0'

# Security Context (Kyverno Policy 준수)
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false  # NocoDB는 /tmp 쓰기 필요

# Probes 설정 (시작 시간 증가)
probes:
  startup:
    enabled: true
    spec:
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 30
  liveness:
    enabled: true
    spec:
      initialDelaySeconds: 60
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
  readiness:
    enabled: true
    spec:
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# -- Configures service settings for the chart.
# @default -- See values.yaml
service:
  main:
    ports:
      http:
        port: 8080

ingress:
  # -- Enable and configure ingress settings for the chart under this key.
  # @default -- See values.yaml
  main:
    enabled: false

affinity: #{}
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: "service"
          operator: In
          values:
          - "tools"

persistence:
  # -- Configure persistence for data to use sqlite backend.
  # @default -- See values.yaml
  data:
    enabled: true
    mountPath: /usr/app/data/
    accessMode: ReadWriteOnce
    size: 100Mi
    emptyDir:
      enabled: false
    storageClassName: oci-bv

# PostgreSQL Database Configuration (별도 설치)
postgresql:
  # Subchart는 지원 중단 - PostgreSQL을 별도로 설치해야 함
  enabled: false
  
  # 별도 설치된 PostgreSQL 접속 정보
  auth:
    postgresPassword: nocodb
    username: nocodb
    password: nocodb
    database: nocodb

