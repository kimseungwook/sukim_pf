# hoppscotch-unified-ingressroute.yaml
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: hoppscotch-unified
  namespace: traefik
spec:
  entryPoints:
    - web
    - websecure
  routes:
    # --- HTTP -> HTTPS 리디렉션 규칙 ---
    - match: Host(`gdhs.goyoai.com`) || Host(`gdahs.goyoai.com`)
      kind: Rule
      middlewares:
        - name: https-redirect
          namespace: hoppscotch

    # --- HTTPS 서비스 라우팅 규칙 ---

    # 백엔드 API -> 3170 포트로 전달
    - kind: Rule
      match: Host(`gdbhs.goyoai.com`)
      priority: 15
      services:
        - name: hoppscotch # 실제 서비스 이름
          namespace: hoppscotch
          port: 3170

    # 관리자 페이지 -> 3100 포트로 전달
    - kind: Rule
      match: Host(`gdahs.goyoai.com`)
      priority: 10
      services:
        - name: hoppscotch
          namespace: hoppscotch
          port: 3100

    # 일반 유저 프론트엔드 -> 3000 포트로 전달
    - kind: Rule
      match: Host(`gdhs.goyoai.com`)
      priority: 10
      services:
        - name: hoppscotch
          namespace: hoppscotch
          port: 3000
          
  tls:
    secretName: goyo-hoppscotch-tls