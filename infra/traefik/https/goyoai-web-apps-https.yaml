apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: goyoai-web-apps-https
  namespace: traefik
spec:
  entryPoints:
    - websecure
  routes:    
    - kind: Rule
      match: Host(`kdevapi.goyoai.com`)
      # priority: 1
      services:
        - name: goyoai-gointern-system
          namespace: goyoai-web
          port: 5000
    - kind: Rule
      match: Host(`kdevapi.goyoai.com`) && PathPrefix(`/grpc`)
      # priority: 2
      services:
        - name: goyoai-gointern-system
          namespace: goyoai-web
          port: 5000
          scheme: h2c
          
    - kind: Rule
      match: Host(`kdevapiportal.goyoai.com`)
      # priority: 1
      services:
        - name: goyoai-gointern-portal
          namespace: goyoai-web
          port: 5000
    - kind: Rule
      match: Host(`kdevapiportal.goyoai.com`) && PathPrefix(`/grpc`)
      # priority: 2
      services:
        - name: goyoai-gointern-portal
          namespace: goyoai-web
          port: 5000
          scheme: h2c

    # - kind: Rule
    #   match: Host(`gointern-api.goyoai.com`) && PathPrefix(`/echo`)
    #   priority: 100
    #   middlewares:
    #     - name: forwarded-headers
    #   services:
    #     - name: echo-server
    #       port: 80

    # - kind: Rule
    #   match: Host(`gointern-api.goyoai.com`) && PathPrefix(`/grpc`)
    #   priority: 200
    #   services:
    #     - name: dev-goyoai-backend-system
    #       port: 5000
    #       scheme: h2c
    # - kind: Rule
    #   match: Host(`www.goyoai.com`)
    #   priority: 18
    #   services:
    #     - name: goyoai-web-page
    #       namespace: goyoai-web
    #       port: 5000
    # - kind: Rule
    #   match: Host(`www.goyoai.com`) && PathPrefix(`/grpc`)
    #   priority: 19
    #   services:
    #     - name: goyoai-web-page
    #       namespace: goyoai-web
    #       port: 5000
    #       scheme: h2c

  tls:
    secretName: kdev-webs-tls
