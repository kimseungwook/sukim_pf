apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: harbor-https
  namespace: traefik
spec:
  entryPoints:
    - websecure
  routes:
    # /api/ 경로 - goyo-harbor-core 서비스로 연결
    - match: Host(`gdhb.goyoai.com`) && PathPrefix(`/api/`)
      kind: Rule
      services:
        - name: goyo-harbor-core
          namespace: harbor
          port: 80

    # /service/ 경로 - goyo-harbor-core 서비스로 연결
    - match: Host(`gdhb.goyoai.com`) && PathPrefix(`/service/`)
      kind: Rule
      services:
        - name: goyo-harbor-core
          namespace: harbor
          port: 80

    # /v2/ 경로 - goyo-harbor-core 서비스로 연결
    - match: Host(`gdhb.goyoai.com`) && PathPrefix(`/v2/`)
      kind: Rule
      services:
        - name: goyo-harbor-core
          namespace: harbor
          port: 80

    # /chartrepo/ 경로 - goyo-harbor-core 서비스로 연결
    - match: Host(`gdhb.goyoai.com`) && PathPrefix(`/chartrepo/`)
      kind: Rule
      services:
        - name: goyo-harbor-core
          namespace: harbor
          port: 80

    # /c/ 경로 - goyo-harbor-core 서비스로 연결
    - match: Host(`gdhb.goyoai.com`) && PathPrefix(`/c/`)
      kind: Rule
      services:
        - name: goyo-harbor-core
          namespace: harbor
          port: 80

    # / 프로젝트 경로 - goyo-harbor-core 서비스로 연결
    - match: Host(`gdhb.goyoai.com`) && PathPrefix(`/projects/`)
      kind: Rule
      services:
        - name: goyo-harbor-core
          namespace: harbor
          port: 80

    # 기타 모든 경로 - harbor-portal 서비스로 연결
    - match: Host(`gdhb.goyoai.com`)
      kind: Rule
      services:
        - name: goyo-harbor-portal
          namespace: harbor
          port: 80

  tls:
    secretName: goyoai-webs-tls  # TLS 인증서 Secret 이름
