commonSettings: &commonSettings
  nodeSelector:
    goyo-svc: monitoring
  tolerations:
    - key: "goyo-svc"
      operator: "Equal"
      value: "monitoring"
      effect: "NoSchedule"

enterprise:
  enabled: false
  legacyLabels: false

minio:
  enabled: false

# Memcached 이미지 - repository에 full path 지정
memcached:
  image:
    repository: docker.io/memcached  # registry 포함
    tag: 1.6.39-alpine
    pullPolicy: IfNotPresent
  podSecurityContext: {}
  priorityClassName: null
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false

# Memcached Exporter 이미지 - repository에 full path 지정
memcachedExporter:
  enabled: true
  image:
    repository: docker.io/prom/memcached-exporter  # registry 포함
    tag: v0.15.3
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      memory: 250Mi
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false
  extraArgs: {}

# Kafka
kafka:
  enabled: true
  image:
    # registry: docker.io
    repository: docker.io/apache/kafka-native
    tag: 4.1.0
    pullPolicy: IfNotPresent
  service:
    port: 9092
    controllerPort: 9093
    type: ClusterIP
  persistence:
    enabled: true
    size: 100Gi
    storageClassName: ""
  resources:
    requests:
      cpu: 2
      memory: 4Gi
    limits:
      memory: 8Gi
  <<: *commonSettings
  securityContext:
    fsGroup: 1001
    runAsGroup: 1001
    runAsNonRoot: true
    runAsUser: 1001
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false
  podDisruptionBudget:
    maxUnavailable: 1
  terminationGracePeriodSeconds: 30

# Rollout Operator
rollout_operator:
  enabled: true
  image:
    registry: docker.io
    repository: grafana/rollout-operator
    tag: v0.32.0
    pullPolicy: IfNotPresent
  podSecurityContext:
    fsGroup: 10001
    runAsGroup: 10001
    runAsNonRoot: true
    runAsUser: 10001
    seccompProfile:
      type: RuntimeDefault
  securityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false

# Mimir 설정
mimir:
  structuredConfig:
    ingest_storage:
      enabled: true
      kafka:
        address: goyo-mimir-distributed-kafka.monitoring.svc.cluster.local:9092
        topic: mimir-ingest
        auto_create_topic_enabled: true
        auto_create_topic_default_partitions: 100
    
    ingester:
      push_grpc_method_enabled: false
      ring:
        final_sleep: 0s
        num_tokens: 512
        tokens_file_path: /data/tokens
        unregister_on_shutdown: false
        heartbeat_period: 2m
        heartbeat_timeout: 10m
        zone_awareness_enabled: true
    
    distributor:
      remote_timeout: 5s
      ring:
        heartbeat_period: 1m
        heartbeat_timeout: 4m
    
    limits:
      max_global_series_per_user: 2000000
      ingestion_rate: 400000
      ingestion_burst_size: 8000000
      max_global_metadata_per_user: 0
      max_global_metadata_per_metric: 0
    
    common:
      storage:
        backend: s3
        s3:
          bucket_name: mimir-bucket-prd
          endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
          access_key_id: 4b8eb9627f942003c8b3d6b66fc6f6caefcb1b9a
          secret_access_key: "+hULmOEAxJI7sgAHZoGBow53K3EQsGbc52thwJKP7X8="
          region: ap-seoul-1
          http:
            insecure_skip_verify: true
    
    ruler_storage:
      backend: s3
      s3:
        bucket_name: mimir-ruler-bucket-prd
        endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
        access_key_id: 4b8eb9627f942003c8b3d6b66fc6f6caefcb1b9a
        secret_access_key: "+hULmOEAxJI7sgAHZoGBow53K3EQsGbc52thwJKP7X8="
        region: ap-seoul-1
        http:
          insecure_skip_verify: true

    alertmanager_storage:
      backend: s3
      s3:
        bucket_name: mimir-alertmanager-bucket-prd
        endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
        access_key_id: 4b8eb9627f942003c8b3d6b66fc6f6caefcb1b9a
        secret_access_key: "+hULmOEAxJI7sgAHZoGBow53K3EQsGbc52thwJKP7X8="
        region: ap-seoul-1
        http:
          insecure_skip_verify: true

    blocks_storage:
      backend: s3
      s3:
        bucket_name: mimir-blocks-bucket-prd
        endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
        access_key_id: 4b8eb9627f942003c8b3d6b66fc6f6caefcb1b9a
        secret_access_key: "+hULmOEAxJI7sgAHZoGBow53K3EQsGbc52thwJKP7X8="
        region: ap-seoul-1
        http:
          insecure_skip_verify: true

# 컴포넌트
admin_api:
  replicas: 1
  <<: *commonSettings

alertmanager:
  replicas: 1
  <<: *commonSettings
  zoneAwareReplication:
    enabled: false

compactor:
  replicas: 1
  <<: *commonSettings

distributor:
  replicas: 2
  <<: *commonSettings

ingester:
  replicas: 3
  <<: *commonSettings
  zoneAwareReplication:
    enabled: true
    migration:
      enabled: false
    zones:
      - name: zone-a
        <<: *commonSettings
      - name: zone-b
        <<: *commonSettings
      - name: zone-c
        <<: *commonSettings

querier:
  replicas: 2
  <<: *commonSettings

query_frontend:
  replicas: 1
  <<: *commonSettings

query_scheduler:
  enabled: true
  replicas: 2
  <<: *commonSettings

ruler:
  replicas: 1
  <<: *commonSettings

store_gateway:
  replicas: 3
  <<: *commonSettings
  zoneAwareReplication:
    enabled: true
    migration:
      enabled: false
    zones:
      - name: zone-a
        <<: *commonSettings
      - name: zone-b
        <<: *commonSettings
      - name: zone-c
        <<: *commonSettings

overrides_exporter:
  enabled: true
  replicas: 1
  <<: *commonSettings

gateway:
  enabledNonEnterprise: true
  replicas: 1
  <<: *commonSettings

nginx:
  enabled: false

# Cache 설정
chunks-cache:
  enabled: true
  replicas: 1
  allocatedMemory: 8192
  maxItemMemory: 64
  connectionLimit: 16384
  <<: *commonSettings

index-cache:
  enabled: true
  replicas: 1
  allocatedMemory: 2048
  maxItemMemory: 16
  connectionLimit: 16384
  <<: *commonSettings

metadata-cache:
  enabled: true
  replicas: 1
  allocatedMemory: 512
  maxItemMemory: 16
  connectionLimit: 16384
  <<: *commonSettings

results-cache:
  enabled: true
  replicas: 1
  allocatedMemory: 1024
  maxItemMemory: 16
  connectionLimit: 16384
  <<: *commonSettings