commonSettings: &commonSettings
  nodeSelector:
    service: monitoring
  tolerations: []

global:
  dnsService: kube-dns
  dnsNamespace: kube-system
  clusterDomain: cluster.local.
  extraEnvFrom:
    - secretRef:
        name: objstore-secret

minio:
  enabled: false

# Memcached image
memcached:
  image:
    repository: memcached
    tag: 1.6.39-alpine
    pullPolicy: IfNotPresent
  podSecurityContext: {}
  priorityClassName: null
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false

# Memcached Exporter image
memcachedExporter:
  enabled: true
  image:
    repository: prom/memcached-exporter
    tag: v0.15.4
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      memory: 250Mi
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false
  extraArgs: {}

# Kafka - for ingest storage architecture
kafka:
  enabled: true
  image:
    registry: docker.io
    repository: docker.io/apache/kafka-native
    tag: 4.1.0
    pullPolicy: IfNotPresent
  service:
    port: 9092
    controllerPort: 9093
    type: ClusterIP
  persistence:
    enabled: true
    size: 10Gi
    storageClassName: ""
  resources:
    requests:
      cpu: 1
      memory: 1Gi
    limits: {}
  <<: *commonSettings
  securityContext:
    fsGroup: 1001
    runAsGroup: 1001
    runAsNonRoot: true
    runAsUser: 1001
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false
  podDisruptionBudget:
    maxUnavailable: 1
  terminationGracePeriodSeconds: 30

# Rollout Operator - required for zone-aware replication
rollout_operator:
  enabled: true
  image:
    repository: docker.io/grafana/rollout-operator
    tag: v0.32.0
    pullPolicy: IfNotPresent
  podSecurityContext:
    fsGroup: 10001
    runAsGroup: 10001
    runAsNonRoot: true
    runAsUser: 10001
    seccompProfile:
      type: RuntimeDefault
  securityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
    allowPrivilegeEscalation: false

# Mimir configuration using environment variables for secrets
mimir:
  structuredConfig:
    common:
      storage:
        backend: s3
        s3:
          bucket_name: mimir-bucket-sukim
          endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
          access_key_id: "${AWS_ACCESS_KEY_ID}"
          secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
          region: ap-seoul-1
          http:
            insecure_skip_verify: true

    blocks_storage:
      backend: s3
      storage_prefix: blocks
      s3:
        bucket_name: mimir-bucket-sukim
        endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
        access_key_id: "${AWS_ACCESS_KEY_ID}"
        secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
        region: ap-seoul-1
        http:
          insecure_skip_verify: true

    ruler_storage:
      backend: s3
      storage_prefix: ruler
      s3:
        bucket_name: mimir-bucket-sukim
        endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
        access_key_id: "${AWS_ACCESS_KEY_ID}"
        secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
        region: ap-seoul-1
        http:
          insecure_skip_verify: true

    alertmanager_storage:
      backend: s3
      storage_prefix: alertmanager
      s3:
        bucket_name: mimir-bucket-sukim
        endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
        access_key_id: "${AWS_ACCESS_KEY_ID}"
        secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
        region: ap-seoul-1
        http:
          insecure_skip_verify: true

    limits:
      max_global_series_per_user: 500000
      ingestion_rate: 100000
      ingestion_burst_size: 2000000
      max_total_query_length: 12000h
      max_query_parallelism: 240
      max_cache_freshness: 10m

# Alertmanager
alertmanager:
  enabled: true
  replicas: 1
  <<: *commonSettings
  zoneAwareReplication:
    enabled: false
  persistentVolume:
    enabled: true
    size: 1Gi

# Compactor
compactor:
  enabled: true
  replicas: 1
  <<: *commonSettings
  persistentVolume:
    enabled: true
    size: 2Gi

# Distributor
distributor:
  enabled: true
  replicas: 1
  <<: *commonSettings
  extraArgs:
    config.expand-env: "true"

# Ingester - zone-aware replication disabled for single-node
ingester:
  enabled: true
  replicas: 1
  <<: *commonSettings
  extraArgs:
    config.expand-env: "true"
  zoneAwareReplication:
    enabled: false
  persistentVolume:
    enabled: true
    size: 2Gi

# Querier
querier:
  enabled: true
  replicas: 1
  <<: *commonSettings
  extraArgs:
    config.expand-env: "true"

# Query Frontend
query_frontend:
  enabled: true
  replicas: 1
  <<: *commonSettings
  extraArgs:
    config.expand-env: "true"

# Query Scheduler
query_scheduler:
  enabled: true
  replicas: 1
  <<: *commonSettings

# Ruler
ruler:
  enabled: true
  replicas: 1
  <<: *commonSettings
  extraArgs:
    config.expand-env: "true"

# Store Gateway - zone-aware replication disabled for single-node
store_gateway:
  enabled: true
  replicas: 1
  <<: *commonSettings
  extraArgs:
    config.expand-env: "true"
  zoneAwareReplication:
    enabled: false
  persistentVolume:
    enabled: true
    size: 2Gi

# Overrides Exporter
overrides_exporter:
  enabled: true
  replicas: 1
  <<: *commonSettings

# Gateway (replaces nginx)
gateway:
  enabled: true
  replicas: 1
  <<: *commonSettings

# Cache settings - disabled for single-node portfolio environment
chunks-cache:
  enabled: false

index-cache:
  enabled: false

metadata-cache:
  enabled: false

results-cache:
  enabled: false