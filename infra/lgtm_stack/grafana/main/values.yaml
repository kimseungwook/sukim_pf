global:
  imagePullSecrets: []

rbac:
  create: true
  pspEnabled: false

serviceAccount:
  create: true
  automountServiceAccountToken: true

replicas: 1

image:
  registry: docker.io
  repository: grafana/grafana
  pullPolicy: IfNotPresent

imagePullSecrets:
    - name: dockerhub-secret

securityContext:
  runAsNonRoot: true
  runAsUser: 472
  runAsGroup: 472
  fsGroup: 472

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL

createConfigmap: true

service:
  enabled: true
  type: ClusterIP
  port: 80
  targetPort: 3000

grafana.ini:
  paths:
    data: /var/lib/grafana/
    logs: /var/log/grafana
    plugins: /var/lib/grafana/plugins
    provisioning: /etc/grafana/provisioning
  analytics:
    check_for_updates: true
  auth:
    signout_redirect_url: "https://authentik.8ai.store/application/o/grafana/end-session/"
    oauth_auto_login: true
  auth.generic_oauth:
    name: authentik
    enabled: true
    client_id: "v0oUWZhTDM6rg5x2SPW4eFWPY6EOcxHqk1uxw46S"
    client_secret: $__env{GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET}  # Secret에서 환경 변수로 주입
    scopes: "openid profile email"
    auth_url: "https://authentik.8ai.store/application/o/authorize/"
    token_url: "https://authentik.8ai.store/application/o/token/"
    api_url: "https://authentik.8ai.store/application/o/userinfo/"
    role_attribute_path: contains(groups, 'Grafana Admins') && 'Admin' || contains(groups, 'Grafana Editors') && 'Editor' || 'Viewer'
  server:
    domain: "grafana.8ai.store"
    root_url: "https://grafana.8ai.store/"

# Secret에서 환경 변수로 주입
envValueFrom:
  GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET:
    secretKeyRef:
      name: grafana-authentik-secret
      key: client-secret


nodeSelector:
  service: "monitoring"

tolerations: #[]
- key: "goyo-svc"
  operator: "Equal"
  value: "monitoring"
  effect: "NoSchedule"

affinity: #{}

persistence:
  enabled: true

sidecar:
  dashboards:
    enabled: true  # ✅ 자동 대시보드 로드
    label: grafana_dashboard
    labelValue: "1"
    searchNamespace: ALL  # 모든 namespace 검색
    folder: /tmp/dashboards
    folderAnnotation: grafana_folder
    provider:
      foldersFromFilesStructure: true
  datasources:
    enabled: true  # ✅ 자동 데이터소스 로드
    label: grafana_datasource
    labelValue: "1"
    searchNamespace: ALL

networkPolicy:
  enabled: false

# The remaining default values are omitted for brevity, add them here if necessary.
