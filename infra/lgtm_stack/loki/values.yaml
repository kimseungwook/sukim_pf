global:
  storageClass: "oci-bv"
  extraEnvFrom:
    - secretRef:
        name: objstore-secret
  extraArgs:
    - "-config.expand-env=true"

loki:
  enabled: true
  auth_enabled: false
  
  deploymentMode: SimpleScalable
  
  commonConfig:
    replication_factor: 1
  
  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: s3  # ⭐ s3로 유지
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  storage:
    type: s3  # ⭐ s3로 유지
    bucketNames:
      chunks: loki-bucket-sukim
      ruler: loki-bucket-sukim
      admin: loki-bucket-sukim
    s3:
      endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
      region: ap-seoul-1
      accessKeyId: "${AWS_ACCESS_KEY_ID}"
      secretAccessKey: "${AWS_SECRET_ACCESS_KEY}"
      s3ForcePathStyle: true
      insecure: false

  limits_config:
    retention_period: 90d
    reject_old_samples: false
    reject_old_samples_max_age: 720h
    ingestion_rate_mb: 50
    ingestion_burst_size_mb: 100
    max_streams_per_user: 0
    max_line_size: 512000
    max_query_lookback: 2160h
    max_query_length: 2161h
    max_query_parallelism: 32
    max_query_series: 5000
    max_cache_freshness_per_query: 10m
    split_queries_by_interval: 24h
    max_entries_limit_per_query: 10000

  compactor:
    working_directory: /var/loki/compactor
    compaction_interval: 30m
    retention_enabled: true
    retention_delete_delay: 24h
    retention_delete_worker_count: 10
    delete_request_store: s3

write:
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi  # WAL만 저장 (데이터는 S3)
    storageClass: "oci-bv"
  nodeSelector:
    service: "monitoring"

read:
  replicas: 1
  persistence:
    enabled: false  # Read는 PVC 불필요
  nodeSelector:
    service: "monitoring"

backend:
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi  # 인덱스만 저장
    storageClass: "oci-bv"
  nodeSelector:
    service: "monitoring"

gateway:
  replicas: 1
  nodeSelector:
    service: "monitoring"

memcached:
  image:
    repository: "docker.io/memcached"
    tag: 1.6.39-alpine

memcachedExporter:
  image:
    repository: "docker.io/prom/memcached-exporter"
    tag: v0.15.4
    pullPolicy: IfNotPresent

serviceAccount:
  create: true

rbac:
  create: true

networkPolicy:
  enabled: true

serviceMonitor:
  enabled: true
  labels:
    release: prometheus-stack

grafana:
  enabled: false
alertmanager:
  enabled: false
prometheus:
  enabled: false