global:
  storageClass: "oci-bv"
  extraEnvFrom:
    - secretRef:
        name: objstore-secret
  extraArgs:
    - "-config.expand-env=true"

loki:
  enabled: true
  auth_enabled: false
  
  # Helm Chart 6.x / Loki 3.x SimpleScalable recommendation
  deploymentMode: SimpleScalable
  replication_factor: 1

  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  storage:
    type: s3
    bucketNames:
      chunks: loki-bucket-sukim
      ruler: loki-bucket-sukim
      admin: loki-bucket-sukim
    s3:
      endpoint: cn7ipyag4bte.compat.objectstorage.ap-seoul-1.oraclecloud.com
      region: ap-seoul-1
      accessKeyId: "${AWS_ACCESS_KEY_ID}"
      secretAccessKey: "${AWS_SECRET_ACCESS_KEY}"
      s3ForcePathStyle: true

  limits_config:
    retention_period: 90d
    reject_old_samples: false
    reject_old_samples_max_age: 720h
    ingestion_rate_mb: 50
    ingestion_burst_size_mb: 100
    max_streams_per_user: 0
    max_line_size: 512000

  table_manager:
    retention_deletes_enabled: false
    retention_period: 90d
    index_tables_provisioning:
      enable_ondemand_throughput_mode: false
      provisioned_read_throughput: 0
      provisioned_write_throughput: 0

  compactor:
    working_directory: /var/loki/compactor

    compaction_interval: 30m
    retention_enabled: false
    retention_delete_delay: 24h
    retention_delete_worker_count: 10

# SimpleScalable Components: write, read, backend

write:
  replicas: 1
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution: []
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: write
                app.kubernetes.io/name: loki
                app.kubernetes.io/instance: loki
            topologyKey: kubernetes.io/hostname
  persistence:
    enabled: true
    size: 50Gi
    storageClass: "oci-bv"
  nodeSelector:
    service: "monitoring"

read:
  replicas: 1
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution: []
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: read
                app.kubernetes.io/name: loki
                app.kubernetes.io/instance: loki
            topologyKey: kubernetes.io/hostname
  persistence:
    enabled: true
    size: 50Gi
    storageClass: "oci-bv"
  nodeSelector:
    service: "monitoring"

backend:
  replicas: 1
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution: []
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: backend
                app.kubernetes.io/name: loki
                app.kubernetes.io/instance: loki
            topologyKey: kubernetes.io/hostname
  persistence:
    enabled: true
    size: 50Gi
    storageClass: "oci-bv"
  nodeSelector:
    service: "monitoring"

# Gateway (Nginx)
gateway:
  replicas: 1
  nodeSelector:
    service: "monitoring"

memcached:
  image:
    # -- Memcached Docker image repository
    repository: "docker.io/memcached"
    # -- Memcached Docker image tag
    tag: 1.6.39-alpine
memcachedExporter:
  image:
    repository: "docker.io/prom/memcached-exporter"
    tag: v0.15.4
    pullPolicy: IfNotPresent
serviceAccount:
  create: true

rbac:
  create: true

networkPolicy:
  enabled: true

serviceMonitor:
  enabled: true
  labels:
    release: prometheus-stack

# Disable unused components
grafana:
  enabled: false
alertmanager:
  enabled: false
prometheus:
  enabled: false
