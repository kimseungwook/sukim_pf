# ëª¨ë“ˆë³„ë¡œ ì‹œì¸ì„± ì¢‹ê²Œ ì •ë¦¬ëœ PVC í…œí”Œë¦¿ (aify ì œê±°, ë™ì  ìƒì„±)
# templates/pvcs.yaml
# ===================================================================

{{- range $moduleName, $moduleConfig := .Values.modules }}
{{- if $moduleConfig.enabled }}
# ===================================================================
# ğŸ”¹ {{ upper $moduleName }} ëª¨ë“ˆ PVC
# ===================================================================

# {{ title $moduleName }} Workspace PVC
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ $moduleConfig.pvc.workspace }}
  namespace: tekton-pipelines
  labels:
    {{- include "backend-system.labels" $ | nindent 4 }}
    module: {{ $moduleName }}
    type: workspace
  annotations:
    description: "{{ title $moduleName }} ëª¨ë“ˆ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ PVC (ReadWriteOnce)"
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: {{ $.Values.global.storage.className }}
  resources:
    requests:
      storage: 5Gi

# {{ title $moduleName }} Cache PVC
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ $moduleConfig.pvc.cache }}
  namespace: tekton-pipelines
  labels:
    {{- include "backend-system.labels" $ | nindent 4 }}
    module: {{ $moduleName }}
    type: cache
  annotations:
    description: "{{ title $moduleName }} ëª¨ë“ˆ Gradle ìºì‹œ PVC"
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: {{ $.Values.global.storage.className }}
  resources:
    requests:
      storage: {{ $.Values.global.storage.size }}

{{- end }}
{{- end }}

# ===================================================================
# ğŸ“Š ë™ì  ìƒì„±ëœ PVC ìš”ì•½ ì •ë³´
# ===================================================================
# 
# í™œì„±í™”ëœ ëª¨ë“ˆë³„ë¡œ ìƒì„±ë˜ëŠ” PVCë“¤:
{{- range $moduleName, $moduleConfig := .Values.modules }}
{{- if $moduleConfig.enabled }}
# 
# ğŸ”¹ {{ upper $moduleName }} ëª¨ë“ˆ:
#   - {{ $moduleConfig.pvc.workspace }} (Workspace, 5Gi)
#   - {{ $moduleConfig.pvc.cache }} (Cache, {{ $.Values.global.storage.size }})
{{- end }}
{{- end }}
# 
# ê° PVCëŠ” ReadWriteOnceë¡œ ë…ë¦½ì  ìš´ì˜
# StorageClass: {{ .Values.global.storage.className }}
# ===================================================================
