# âœ… 1. PVCëŠ” ê³µìœ  ì‚¬ìš© (ë¦¬ì†ŒìŠ¤ ì ˆì•½)
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ .Values.project_name }}-workspace
  namespace: tekton-pipelines
  labels:
    app: goyoai-gointern-web
    purpose: shared-workspace
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: {{ .Values.storage_ClassName}}
  resources:
    requests:
      storage: 10Gi  # PRê³¼ Mainì´ ê³µìœ í•˜ë¯€ë¡œ ì¡°ê¸ˆ ë” í¬ê²Œ
---
# âœ… 2. PR ì „ìš© ì •ë¦¬ Task
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: {{ .Values.project_name }}-pr-cleanup
  namespace: tekton-pipelines
spec:
  description: Clean up PR environment resources
  params:
    - name: pr-number
      type: string
      description: "PR number to clean up"
    - name: container-registry-url
      type: string
  steps:
    - name: cleanup-pr-images
      image: {{ .Values.common_alpine_url }}
      script: |
        #!/bin/sh
        echo "ğŸ§¹ Cleaning up PR-$(params.pr-number) environment..."
        
        # PR ê´€ë ¨ ì´ë¯¸ì§€ ì •ë¦¬ (ì„ íƒì‚¬í•­)
        echo "PR-$(params.pr-number) cleanup completed"
        
        # Slack ì•Œë¦¼
        apk add --no-cache curl
        SLACK_WEBHOOK_URL="{{ .Values.slack_webhook_url }}"
        SLACK_MESSAGE="ğŸ—‘ï¸ PR-$(params.pr-number) environment cleaned up"
        curl -X POST -H 'Content-type: application/json' \
        --data '{"text":"'"$SLACK_MESSAGE"'"}' \
        $SLACK_WEBHOOK_URL