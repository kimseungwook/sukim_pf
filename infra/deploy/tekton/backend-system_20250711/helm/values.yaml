# ===================================================================
# ğŸ—ï¸ GOYOAI BACKEND SYSTEM CI/CD VALUES
# ëª¨ë“ˆë³„ë¡œ êµ¬ì¡°í™”ëœ ì„¤ì • íŒŒì¼ (ReadWriteOnce PVC ëŒ€ì‘)
# ===================================================================

# ğŸ”§ ê³µí†µ í”„ë¡œì íŠ¸ ì„¤ì •
# ===================================================================
project_name: "gointern-backend"
gitUrl: "https://github.com/kimseungwook/sukim-backend-system"

# ğŸŒ ê³µí†µ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„¤ì •
# ===================================================================
container_registry_url: "gdhb.goyoai.com/gointern"
container_registry_cache_url: "gdhb.goyoai.com/gointern-cache"
container_registry_secretName: "harbor-registry-secret"

# ğŸ³ ê³µí†µ ì´ë¯¸ì§€ ì„¤ì •
# ===================================================================
common_alpine_url: "gdhb.goyoai.com/common/alpine:3.20.3"
common_alpine_git_url: "gdhb.goyoai.com/common/git:2.45.2"
common_kaniko_url: "gdhb.goyoai.com/common/kaniko:1.23.2"

# ğŸ’¾ ê³µí†µ ìŠ¤í† ë¦¬ì§€ ì„¤ì •
# ===================================================================
storage_ClassName: "oci-bv"
storage_size: "1Gi"  # ìºì‹œ í¬ê¸°

# ğŸ”— Kustomize ê³µí†µ ì„¤ì •
# ===================================================================
kustomize_git_url: "https://github.com/GoyoAi-Service/goyoai-web-manifest"
manifestFileName: "goyoai-backend-system-manifest.yaml"
commitMessage: "Update Kubernetes manifest"

# ğŸ“¢ ì•Œë¦¼ ì„¤ì •
# ===================================================================
slack_webhook_url: "https://hooks.slack.com/services/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"

# ===================================================================
# ğŸ”· SYSTEM ëª¨ë“ˆ ì„¤ì •
# ===================================================================
system:
  # Git ì„¤ì •
  gitBranch: "dev-system"
  
  # ë¹Œë“œ ì„¤ì •
  moduleName: "goyoai-gointern-system"
  dockerfileName: "dockerfile-system-dev"
  
  # Kustomize ì„¤ì •
  kustomize:
    branch: "dev"
    directory: "goyoai-backend-system/overlays/dev"
    deploymentName: "dev-goyoai-backend-system"
  
  # PVC ì„¤ì • (ReadWriteOnce ë…ë¦½)
  pvc:
    workspace: "gointern-backend-system"
    cache: "gointern-system-gradle-cache"
  
  # Task ì´ë¦„
  buildTaskName: "goyoai-gointern-system-image-build"

# ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­ ì„¤ì • (System)
gitRevisions: ["dev-portal", "dev-system", "dev-aify"]
back_kustomize_git_branch: "dev"
back_kustomize_directory: "goyoai-backend-system/overlays/dev"
back_deployment_name: "dev-goyoai-backend-system"
system_gradle_cache_pvc_name: "gointern-system-gradle-cache"
system_build_task_name: "goyoai-gointern-system-image-build"

# ===================================================================
# ğŸ”¶ PORTAL ëª¨ë“ˆ ì„¤ì •
# ===================================================================
portal:
  # Git ì„¤ì •
  gitBranch: "dev-portal"
  
  # ë¹Œë“œ ì„¤ì •
  moduleName: "goyoai-gointern-portal"
  dockerfileName: "dockerfile-portal-dev"
  
  # Kustomize ì„¤ì •
  kustomize:
    branch: "dev"
    directory: "goyoai-web-back-portal-v2/overlays/dev"
    deploymentName: "goyoai-web-back-portal-v2"
  
  # PVC ì„¤ì • (ReadWriteOnce ë…ë¦½)
  pvc:
    workspace: "gointern-backend-portal"
    cache: "gointern-portal-gradle-cache"
  
  # Task ì´ë¦„
  buildTaskName: "goyoai-gointern-portal-image-build"

# ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­ ì„¤ì • (Portal)
portal_kustomize_git_branch: "dev"
portal_kustomize_directory: "goyoai-web-back-portal-v2/overlays/dev"
portal_deployment_name: "goyoai-web-back-portal-v2"
portal_gradle_cache_pvc_name: "gointern-portal-gradle-cache"
portal_build_task_name: "goyoai-gointern-portal-image-build"

# ===================================================================
# ğŸ”¸ AIFY ëª¨ë“ˆ ì„¤ì •
# ===================================================================
aify:
  # Git ì„¤ì •
  gitBranch: "dev-aify"
  
  # ë¹Œë“œ ì„¤ì •
  moduleName: "goyoai-gointern-aify"
  dockerfileName: "dockerfile-aify-dev"
  
  # Kustomize ì„¤ì •
  kustomize:
    branch: "dev"
    directory: "goyoai-aify-system/overlays/dev"
    deploymentName: "dev-goyoai-aify-system"
  
  # PVC ì„¤ì • (ReadWriteOnce ë…ë¦½)
  pvc:
    workspace: "gointern-backend-aify"
    cache: "gointern-aify-gradle-cache"
  
  # Task ì´ë¦„
  buildTaskName: "goyoai-gointern-aify-image-build"

# ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­ ì„¤ì • (Aify)
aify_kustomize_git_branch: "dev"
aify_kustomize_directory: "goyoai-aify-system/overlays/dev"
aify_deployment_name: "dev-goyoai-aify-system"
aify_gradle_cache_pvc_name: "gointern-aify-gradle-cache"
aify_build_task_name: "goyoai-gointern-aify-image-build"

# ===================================================================
# ğŸ¯ EventListener ì„¤ì •
# ===================================================================
eventListener:
  serviceAccountName: "tekton-triggers-sa"
  
  # ë…¸ë“œ ì„ íƒì
  nodeSelector:
    key: "goyo-svc"
    value: "deploy"
  
  # Tolerations
  tolerations:
    key: "goyo-svc"
    value: "deploy"
    operator: "Equal"
    effect: "NoSchedule"
  
  # ë¦¬ì†ŒìŠ¤ ì œí•œ
  resources:
    requests:
      memory: "64Mi"
      cpu: "250m"
    limits:
      memory: "128Mi"
      cpu: "500m"

# ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­ ì„¤ì • (EventListener)
el_serviceAccountName: "tekton-triggers-sa"
el_node_selector_key: "goyo-svc"
el_node_selector_value: "deploy"
el_tolerations_key: "goyo-svc"
el_tolerations_value: "deploy"
el_tolerations_operator: "Equal"
el_tolerations_effect: "NoSchedule"

# ===================================================================
# ğŸ” ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ ì„¤ì •
# ===================================================================
serviceAccounts:
  git: "tekton-sukim-token"
  triggers: "tekton-triggers-sa"

# ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­
git_serviceAccountName: "tekton-sukim-token"

# ===================================================================
# ğŸš€ íŠ¸ë¦¬ê±° ì„¤ì •
# ===================================================================
trigger:
  # ë…¸ë“œ ì„ íƒì
  nodeSelector:
    key: "goyo-svc"
    value: "deploy"
  
  # Affinity
  affinity:
    operator: "In"
  
  # Tolerations
  tolerations:
    key: "goyo-svc"
    value: "deploy"
    operator: "Equal"
    effect: "NoSchedule"

# ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­ ì„¤ì • (Trigger)
trigger_node_selector_key: "goyo-svc"
trigger_node_selector_value: "deploy"
trigger_node_affinity_operator: "In"
trigger_tolerations_key: "goyo-svc"
trigger_tolerations_value: "deploy"
trigger_tolerations_operator: "Equal"
trigger_tolerations_effect: "NoSchedule"

# ===================================================================
# ğŸ·ï¸ ê³µí†µ ë¼ë²¨ ë° ì–´ë…¸í…Œì´ì…˜
# ===================================================================
commonLabels:
  app: "tekton-backend-system"
  version: "v2.0.0"
  team: "devops"
  environment: "development"
  
commonAnnotations:
  "tekton.dev/pipelines.minVersion": "0.17.0"
  "tekton.dev/categories": "Image Build"
  "tekton.dev/tags": "image-build,backend,mono-repo"
  "helm.sh/resource-policy": "keep"

# ===================================================================
# ğŸ”§ ê³ ê¸‰ ì„¤ì • (ì˜µì…˜)
# ===================================================================
advanced:
  # ë¹Œë“œ ìµœì í™”
  gradle:
    opts: "-Dorg.gradle.daemon=false -Dorg.gradle.parallel=true -Dorg.gradle.workers.max=2 -Dorg.gradle.caching=true -Dorg.gradle.vfs.watch=false -Dkotlin.compiler.execution.strategy=in-process"
    userHome: "/workspace/gradle-home"
  
  # Kaniko ìµœì í™”
  kaniko:
    args:
      - "--force"
      - "--skip-tls-verify" 
      - "--skip-unused-stages"
      - "--use-new-run"
      - "--cache=true"
      - "--cache-ttl=168h"
      - "--cache-copy-layers"
      - "--snapshot-mode=redo"
      - "--compressed-caching=false"
      - "--ignore-var-run"
      - "--cleanup"
      - "--cache-dir=/cache"
  
  # íƒ€ì„ì•„ì›ƒ ì„¤ì •
  timeouts:
    pipeline: "2h0m0s"
    tasks: "1h30m0s"
    finally: "15m0s"
  
  # ì •ë¦¬ ì„¤ì •
  cleanup:
    enabled: true
    schedule: "0 2 * * *"  # ë§¤ì¼ ìƒˆë²½ 2ì‹œ
    retentionDays: 7

# ===================================================================
# ğŸ“Š ëª¨ë‹ˆí„°ë§ ì„¤ì • (ì˜µì…˜)
# ===================================================================
monitoring:
  enabled: false
  prometheus:
    enabled: false
    serviceMonitor: false
  grafana:
    enabled: false
    dashboard: false

# ===================================================================
# ğŸ”’ ë³´ì•ˆ ì„¤ì •
# ===================================================================
security:
  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: false  # KanikoëŠ” root ê¶Œí•œ í•„ìš”
    capabilities:
      drop:
        - ALL

# ===================================================================
# ğŸŒŸ ìƒˆ ëª¨ë“ˆ ì¶”ê°€ í…œí”Œë¦¿ (í™•ì¥ìš©)
# ===================================================================
# ìƒˆë¡œìš´ ëª¨ë“ˆ ì¶”ê°€ ì‹œ ì•„ë˜ í…œí”Œë¦¿ì„ ì°¸ê³ í•˜ì„¸ìš”
# 
# newModule:
#   gitBranch: "dev-new"
#   moduleName: "goyoai-gointern-new"
#   dockerfileName: "dockerfile-new-dev"
#   kustomize:
#     branch: "dev"
#     directory: "goyoai-new-system/overlays/dev"
#     deploymentName: "dev-goyoai-new-system"
#   pvc:
#     workspace: "gointern-backend-new"
#     cache: "gointern-new-gradle-cache"
#   buildTaskName: "goyoai-gointern-new-image-build"

# ===================================================================
# ğŸ“ ì„¤ì • ê°€ì´ë“œ
# ===================================================================
# 
# ğŸ”¹ ìƒˆ ëª¨ë“ˆ ì¶”ê°€ ë°©ë²•:
# 1. ìœ„ì˜ í…œí”Œë¦¿ì„ ë³µì‚¬í•˜ì—¬ ìƒˆ ëª¨ë“ˆ ì„¹ì…˜ ì¶”ê°€
# 2. gitRevisions ë°°ì—´ì— ìƒˆ ë¸Œëœì¹˜ ì¶”ê°€
# 3. EventListenerì˜ CEL í‘œí˜„ì‹ì— ìƒˆ ëª¨ë“ˆ ì¡°ê±´ ì¶”ê°€
# 4. í•„ìš”ì‹œ ìƒˆ íŒŒì´í”„ë¼ì¸ ë° íƒœìŠ¤í¬ í…œí”Œë¦¿ ìƒì„±
# 
# ğŸ”¹ PVC í¬ê¸° ì¡°ì •:
# storage_size ê°’ì„ ìˆ˜ì •í•˜ì—¬ ìºì‹œ í¬ê¸° ì¡°ì • ê°€ëŠ¥
# 
# ğŸ”¹ ë¦¬ì†ŒìŠ¤ ì œí•œ ì¡°ì •:
# eventListener.resourcesì—ì„œ CPU/ë©”ëª¨ë¦¬ ì œí•œ ì¡°ì •
# 
# ğŸ”¹ ë…¸ë“œ ìŠ¤ì¼€ì¤„ë§ ë³€ê²½:
# nodeSelector, tolerations ì„¹ì…˜ì—ì„œ ë°°í¬ ë…¸ë“œ ì œì–´
# 
# ===================================================================