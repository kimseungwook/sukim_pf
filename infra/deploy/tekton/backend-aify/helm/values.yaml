# ===================================================================
# ğŸ—ï¸ GOYOAI BACKEND SYSTEM CI/CD VALUES
# ëª¨ë“ˆë³„ë¡œ êµ¬ì¡°í™”ëœ ì„¤ì • íŒŒì¼ (ReadWriteOnce PVC ëŒ€ì‘)
# ===================================================================

# ğŸ”§ ê¸€ë¡œë²Œ í”„ë¡œì íŠ¸ ì„¤ì •
# ===================================================================
global:
  project_name: "aify-backend"
  gitUrl: "https://github.com/kimseungwook/sukim-backend-system"
  
  # ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬
  registry:
    url: "gdhb.goyoai.com/aify"
    cache_url: "gdhb.goyoai.com/aify-cache"
    secret: "harbor-registry-secret"
  
  # ê³µí†µ ì´ë¯¸ì§€
  images:
    alpine: "gdhb.goyoai.com/common/alpine:3.20.3"
    alpine_git: "gdhb.goyoai.com/common/git:2.45.2"
    kaniko: "gdhb.goyoai.com/common/kaniko:1.23.2"
  
  # ìŠ¤í† ë¦¬ì§€
  storage:
    className: "oci-bv"
    size: "1Gi"
  
  # Kustomize ì„¤ì •
  kustomize:
    gitUrl: "https://github.com/GoyoAi-Service/goyoai-web-manifest"
    manifestFileName: "goyoai-backend-system-manifest.yaml"
    commitMessage: "Update Kubernetes manifest"
  
  # ì•Œë¦¼
  slack:
    webhook_url: "https://hooks.slack.com/services/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"

# ===================================================================
# ğŸ“¦ ëª¨ë“ˆ ì„¤ì • (ë™ì  í™•ì¥ ê°€ëŠ¥)
# ===================================================================
modules:
  # ğŸ”· SYSTEM ëª¨ë“ˆ
  system:
    enabled: true
    git:
      branch: "prod-aify-system"
    build:
      moduleName: "aify-backend-system"
      dockerfileName: "dockerfile-aify-system-prod"
    kustomize:
      branch: "dev"
      directory: "aify-backend-system/overlays/dev"
      deploymentName: "aify-backend-system"
    pvc:
      workspace: "aify-backend-system"
      cache: "aify-backend-system-cache"
    taskName: "aify-backend-system-image-build"
    pipelineName: "aify-backend-system"
  
  # ğŸ”¶ PORTAL ëª¨ë“ˆ
  portal:
    enabled: true
    git:
      branch: "prod-aify-portal"
    build:
      moduleName: "aify-backend-portal"
      dockerfileName: "dockerfile-aify-portal-prod"
    kustomize:
      branch: "dev"
      directory: "aify-backend-portal/overlays/dev"
      deploymentName: "aify-backend-portal"
    pvc:
      workspace: "aify-backend--portal"
      cache: "aify-backend-gradle-cache"
    taskName: "aify-backend-portal-image-build"
    pipelineName: "aify-backend-portal"

# ===================================================================
# ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
# ===================================================================
eventListener:
  name: "aify-backend"
  serviceAccount: "tekton-triggers-sa"
  
  nodeSelector:
    "goyo-svc": "deploy"
  
  tolerations:
    - key: "goyo-svc"
      value: "deploy"
      operator: "Equal"
      effect: "NoSchedule"
  
  resources:
    requests:
      memory: "64Mi"
      cpu: "250m"
    limits:
      memory: "128Mi"
      cpu: "500m"

# ===================================================================
# ğŸ” ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ ì„¤ì •
# ===================================================================
serviceAccounts:
  git: "tekton-sukim-token"
  triggers: "tekton-triggers-sa"

# ===================================================================
# ğŸš€ íŒŒì´í”„ë¼ì¸ ê³µí†µ ì„¤ì •
# ===================================================================
pipeline:
  nodeSelector:
    "goyo-svc": "deploy"
  
  tolerations:
    - key: "goyo-svc"
      value: "deploy"
      operator: "Equal"
      effect: "NoSchedule"
  
  timeouts:
    pipeline: "2h0m0s"
    tasks: "1h30m0s"
    finally: "15m0s"

# ===================================================================
# ğŸ”§ ë¹Œë“œ ìµœì í™” ì„¤ì •
# ===================================================================
build:
  gradle:
    opts: >-
      -Dorg.gradle.daemon=false
      -Dorg.gradle.parallel=true
      -Dorg.gradle.workers.max=2
      -Dorg.gradle.caching=true
      -Dorg.gradle.vfs.watch=false
      -Dkotlin.compiler.execution.strategy=in-process
    userHome: "/workspace/gradle-home"
  
  kaniko:
    args:
      - "--force"
      - "--skip-tls-verify"
      - "--skip-unused-stages"
      - "--use-new-run"
      - "--cache=true"
      - "--cache-ttl=168h"
      - "--cache-copy-layers"
      - "--snapshot-mode=redo"
      - "--compressed-caching=false"
      - "--ignore-var-run"
      - "--cleanup"
      - "--cache-dir=/cache"

# ===================================================================
# ğŸ·ï¸ ê³µí†µ ë¼ë²¨ ë° ì–´ë…¸í…Œì´ì…˜
# ===================================================================
commonLabels:
  app.kubernetes.io/name: "tekton-aify-backend"
  app.kubernetes.io/version: "2.0.0"
  app.kubernetes.io/managed-by: "Helm"
  app.kubernetes.io/component: "ci-cd"
  team: "devops"
  environment: "development"

commonAnnotations:
  "tekton.dev/pipelines.minVersion": "0.17.0"
  "tekton.dev/categories": "Image Build"
  "tekton.dev/tags": "image-build,backend,mono-repo"
  "helm.sh/resource-policy": "keep"

# ===================================================================
# ğŸ”’ ë³´ì•ˆ ì„¤ì •
# ===================================================================
security:
  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: false  # Kaniko requires root
    capabilities:
      drop:
        - ALL

# ===================================================================
# ğŸŒŸ ìƒˆ ëª¨ë“ˆ ì¶”ê°€ í…œí”Œë¦¿ (í™•ì¥ìš©)
# ===================================================================
# ìƒˆë¡œìš´ ëª¨ë“ˆ ì¶”ê°€ ì‹œ modules ì„¹ì…˜ì— ì•„ë˜ í…œí”Œë¦¿ì„ ì¶”ê°€í•˜ì„¸ìš”:
# 
# newModule:
#   enabled: true
#   git:
#     branch: "dev-new"
#   build:
#     moduleName: "goyoai-gointern-new"
#     dockerfileName: "dockerfile-new-dev"
#   kustomize:
#     branch: "dev"
#     directory: "goyoai-new-system/overlays/dev"
#     deploymentName: "dev-goyoai-new-system"
#   pvc:
#     workspace: "gointern-backend-new"
#     cache: "gointern-new-gradle-cache"
#   taskName: "goyoai-gointern-new-image-build"

# ===================================================================
# ğŸ“ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
# ===================================================================
# 
# ğŸ”¹ ê¸°ì¡´ ê°’ ë§¤í•‘:
# - project_name â†’ global.project_name
# - container_registry_url â†’ global.registry.url
# - system.* â†’ modules.system.*
# - portal.* â†’ modules.portal.*
# - aify.* â†’ ì‚­ì œë¨ (ë³„ë„ ê´€ë¦¬)
# 
# ğŸ”¹ ìƒˆ ëª¨ë“ˆ ì¶”ê°€:
# 1. modules ì„¹ì…˜ì— ìƒˆ ëª¨ë“ˆ ì •ì˜
# 2. enabled: trueë¡œ ì„¤ì •
# 3. í…œí”Œë¦¿ì—ì„œ ë™ì ìœ¼ë¡œ ì²˜ë¦¬ë¨
# 
# ===================================================================
